import Warning from '../../components/Warning'
import Code from '../../components/Code'
import Note from '../../components/Note'

###### Syncing schemas

# Making Sure Your Schemas Are Up-to-Date

As a developer working with Lifeforge, it's crucial to ensure that your database schemas (located at <code>apps/[module]/server/schemas.ts</code>) are always in sync with your application's models. Lifeforge provides a straightforward way to synchronize your schemas using the ForgeCLI tool.

---

<section id="generating-schemas-from-database">
## Generating Schemas from Database

When you make changes to your database structure, such as adding new tables or modifying existing ones, you do it through the PocketBase admin UI. To reflect these changes in your application's codebase, you need to generate the corresponding Zod schemas. You can do this by running the following command in your terminal:

<Code language="bash">
{`bun run forge db generate-schemas [module]`}
</Code>

Replace <code>[module]</code> with the name of the module for which you want to generate the schemas. If not specified, it will generate schemas for all modules.

This command will connect to your PocketBase instance, retrieve the current database structure, and generate Zod schemas based on the collections and fields defined in your database. The generated schemas will be saved in the schema file of the respective module.

The collection metadata will also be saved alongside with the zod schemas, which is used to generate migration scripts that sync the database structure with the codebase.

<Note>
If the schema file for a module does not exist yet, running this command will create a new schema file with the generated schemas.
</Note>

<Warning>
  ### Collection Naming Convention
  When generating schemas from the database, make sure that your collection name follows the naming convention as follows:

  <Code language="plaintext">
  {`module_name__collection_name`}
  </Code>

  Note that everything should be in snake case. This convention is important because the ForgeCLI uses the module name prefix to determine which module the collection belongs to. If the naming convention is not followed, the collection will be ignored during the schema generation process.

  For example, if you have a module named <code>My Blog</code> and a collection named <code>post_entries</code>, the collection should be named <code>my_blog__post_entries</code> in PocketBase for the ForgeCLI to recognize it correctly.

  ### Do Not Modify Generated Schemas Manually
  The Zod schemas generated by the ForgeCLI are automatically created based on the database structure. Therefore, it is strongly advised not to modify these generated schemas manually. Any manual changes made to the schemas may be overwritten the next time you run the schema generation command, leading to potential loss of your changes and inconsistencies between your codebase and database structure.
</Warning>
</section>

<section id="applying-schemas-to-database">
## Applying Schemas to Database

When you install or update a module, it is very likely that the module comes with its own set of database schemas that need to be applied to your PocketBase instance, or the module author has made changes to the existing schemas. To apply these schemas to your database, you can use the following command:

<Code language="bash">
{`bun run forge db generate-migrations [module]`}
</Code>

This command will read the collection metadata defined in the module's schema file and generate migration scripts to update your PocketBase database accordingly. If you specify a module name, it will only apply the migrations for that specific module; otherwise, it will apply migrations for all installed modules.

Don't worry, this script will be run automatically whenever you install or update a module using the ForgeCLI, so you don't have to run it manually every time.

<Warning>
  ### Backup Your Database
  To prevent any potential data loss, it is highly recommended to back up your PocketBase database before running the migration command. LifeForge is utilizing the built-in migration system of PocketBase, which is (hopefully) generally safe, but it's always better to be cautious when making changes to your database structure.
</Warning>
</section>