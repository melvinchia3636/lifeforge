import { Icon } from '@iconify/react'

import { Alert } from "lifeforge-ui"
import EnvExample from './components/EnvExample'

###### Configuration

# Linking Everything Together

Time to configure everything together. Don't worry, it's not as hard as it sounds. Just follow the steps below and you'll be good to go.

---

<section id="environment-variables">
## Environment Variables

Normally in a production environment, you would set up environment variables for storing all sorts of sensitive information like API keys, database URLs, and other secrets. However, in LifeForge, API keys will not be stored in environment variables. Instead, a dedicated collection in the database will be used to store all the encrypted API keys and secrets, so that they can be easily accessed by the modules that need them.

Before proceeding with the database initialization, there are a couple of environment variables that you need to set up beforehand. These variables are stored in a dotenv file located in the `env` directory. A default dotenv file is provided in the `env/.env.example` file. You can copy this file to `env/.env.local` and modify the values as needed. There are only several environment variables that need to be set up for the system to work properly.

<EnvExample />

For the client side, the one and only environment variable that needs to be set up is the `VITE_API_HOST`. This variable specifies the base URL for the API server. If you are running the system locally, you can set it to `http:\/\/localhost:3636` (or any other port that you are using). If you are deploying the system to a remote server, you can set it to the URL of your server.

For the server side, there are several environment variables that need to be set up:

- `PORT`: The port number for the API server. Default to
  `3636`.
- `PB_DIR`: The path relative to the root of the project that points
  to the directory that contains your Pocketbase instance. Default to
  `database/`.
- `PB_HOST`: The base URL for the Pocketbase instance. It will be
  displayed when you start your db instance. Default to
  `http:\/\/localhost:8090`.
- `PB_EMAIL`: The email of the admin user. Will be set automatically
  when you initialize the database.
- `PB_PASSWORD`: The password of the admin user. Will be set
  automatically when you initialize the database.
- `MASTER_KEY`: The master key for encrypting and decrypting API keys
  and other secrets. You can set it to any random string. Make sure to: 
    - Use a strong and unique string that is hard to guess. 
    - Keep it secret and do not share it with anyone. 

  <Alert className="mt-6" type="caution">
    **DO NOT LOSE THE MASTER KEY!** If you lose it, all the encrypted data stored in the
    database will be voided and you will not be able to recover it.
  </Alert>

</section>

<section id="the-forge-cli">
## The Forge CLI

The Forge CLI is a command-line interface tool that helps you manage and configure your LifeForge system. It provides a simple way to manage your system and modules. This tool doesn't require any installation, as it's included in the monorepo inside the `tools/forgeCLI` directory. You can run it using bun.

```bash
bun run forge
```

After that, you should see the Forge CLI help menu.

![](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/25w52-5.webp)

With that out of the way, let's move on to the configuration.

</section>

<section id="database-configuration">
## Database Configuration

Pocketbase is just an empty shell out of the box. You need to set up the database schema and create an admin user. Fortunately, the Forge CLI can help you with that. To set up the database, run the following command:

```bash
bun run forge db init 
```

This initialization process will do quite a few things:

- Download and extract the latest Pocketbase binary into the `database/` directory (if not already present).
- Create superuser account using the email and password specified in the environment variables (`PB_EMAIL` and `PB_PASSWORD`).
- Run database migrations to set up the necessary collections and fields.
- Initialize route and schema files from templates in the server codebase.

<Alert className="mt-6" type="warning">
  Make sure the database instance is not running when you run this command. The
  command will start the database instance automatically when needed.
</Alert>

Now, you can start the Pocketbase instance using the following command:

```bash
bun run forge start db
```

This will start the Pocketbase instance. You can access the admin dashboard at <a href="http://localhost:8090/_" target="_blank" rel="noopener noreferrer">http://localhost:8090/\_</a>. Enter the email and password you provided earlier to log in.

After logging in, you should see the admin dashboard with the collections and fields set up, and a default user record created.

![Pocketbase Admin Dashboard](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/assets/configurations/db-firstlook.webp)

As for the settings, feel free to explore and configure them as per your requirements. You can even setup S3 buckets for file storage (which is a cool feature provided by Pocketbase so that you can store files in the cloud). However, the default settings should work fine for most use cases.

That is it for the database configuration. Now, let's move on to the next step: configuring the environment variables.

### Setting Up OAuth2 Providers

LifeForge currently supports OAuth2 authentication via Google and GitHub. To enable these providers, you need to set them up in the Pocketbase admin dashboard under the settings tab in "Users" collection. After they have been set up, LifeForge will automatically detect them and enable the corresponding login options in the client application.

![OAuth2 Providers](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/assets/configurations/with-2fa.webp)

</section>

<section id="starting-the-api-server">
## Starting the API Server

To start the API server, run the following command:

```bash
bun run forge dev server
```

Once started, you should see an output similar to this:

![API Server Started](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/assets/configurations/server-start.webp)

<Alert className="mt-6" type="note">
  Make sure the Pocketbase instance is running before starting the API server.
  The API server needs to connect to the Pocketbase instance to function
  properly.
</Alert>

The server will first perform a health check to ensure that the Pocketbase instance is reachable and all the necessary collections and fields are set up correctly and are in sync with the codebase. If everything is fine, the server will start and listen for incoming requests.

To verify that the server is running, you can open your browser and navigate to <a href="http://localhost:3636/api/health" target="_blank" rel="noopener noreferrer">http://localhost:3636</a> (or the port you specified in the `PORT` environment variable). You should see a JSON response greeting you:

```json
{
    "state": "success",
    "message": "Get ready to forge your life!"
}
```

If you see this message, congratulations! The API server is up and running. You can now proceed to start the client application, which is the very last step before you can start installing some juicy modules.

</section>

<section id="starting-the-client">
## Starting the Client

To start the client application, run the following command:

```bash
bun run forge dev client
```

It will first build the UI and the shared library using Vite, and then start the development server of the client codebase. You should see an output similar to this:

![Client Started](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/assets/configurations/client-start.webp)

If everything is set up correctly, you be able to see the login screen of your LifeForge system by navigating to <a href="http://localhost:5173" target="_blank" rel="noopener noreferrer">http://localhost:5173</a> (or whatever url Vite tells you to use).

<Alert className="mt-6" type="note">
If your server is up and running but the client application shows that the API is offline, make sure that your client url is added to the list of allowed origins in `server/src/core/routes/constants/corsAllowedOrigins.ts`. By default, only `http:\/\/localhost:5173` is allowed. You can add more origins as needed. If you are deploying the system to a remote server, make sure to add your custom domain to the list of allowed origins as well.
</Alert>
</section>

---

And that's it! You have successfully configured your LifeForge system. Now you should be able to start the system locally and access it from your browser. You may now proceed to the user guide to explore everything that LifeForge has to offer.

If you are ready to make your system available from anywhere, head over to the [Deployment Guide](/getting-started/deployment) to learn how to deploy your system to a cloud server.
