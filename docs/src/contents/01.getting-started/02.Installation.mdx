import { Icon } from '@iconify/react'

import { Alert } from "lifeforge-ui"

###### Installation

# Getting Started with LifeForge.

Back in the day, LifeForge used to be a collection of multiple repositories, where the frontend and backend are separated into different repositories. This made it hard for new users and developers to get started with the project, as they had to clone multiple repositories and set up the environment for each of them. To solve this problem, I decided to merge all the repositories into a single monorepo. This way, people only need to clone a single repository and set up the environment once.

---

<section id="docker-installation">
## Docker Installation

Docker is the easiest way to get LifeForge up and running. It handles all dependencies and configuration automatically.

### Prerequisites

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="simple-icons:docker" className="translate-y-1" />
      **Docker & Docker Compose:**
    </span>
    <span>
      Make sure you have [Docker](https://www.docker.com/get-started/) and Docker Compose installed on your system.
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="tabler:brain" className="translate-y-1" />
      **A functional brain:**
    </span>
    <span>
      While Docker simplifies the installation process, you'll still need to understand basic command-line operations, and how to ~~prompt ai~~ debug if something goes wrong.
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="uil:nerd" className="translate-y-1" />
      **Nerdy knowledges:**
    </span>
    <span>
      People who are using Docker are usually a bit nerdy already. So I assume you know your way around Docker and containers. :)
    </span>
  </div>

### Setup

1. Clone the repository:

    ```bash
    git clone https://github.com/lifeforge-app/lifeforge.git
    cd lifeforge
    ```

2. Create the environment file:

    ```bash
    cp env/.env.docker.example env/.env.docker
    ```

3. Edit `env/.env.docker` and set the required variables. Docker will use this file for configuration:

    ```bash
    PB_EMAIL=your-email@example.com    # Admin email
    PB_PASSWORD=your-secure-password   # Admin password (min 8 chars)
    MASTER_KEY=your-master-key-here    # Encryption key (min 16 chars)
    ```

4. Build and start the containers:

    ```bash
    docker compose build
    docker compose up
    ```

<Alert className="mt-6" type="important">
#### Type Inference Dependencies

The client uses the server's database schemas for API type inference. Before building Docker containers, ensure schemas are up to date by running locally:

```bash
bun install --linker isolated
bun forge db pull
docker compose build
docker compose up
```

Usually, installing and removing modules through ForgeCLI will automatically sync the schemas. If you have modified the schemas manually, you will need to run `bun forge db pull` to update the schemas.
</Alert>

### Accessing LifeForge

Once the containers are running, you can access LifeForge at:

- **Web Interface:** [http://localhost](http://localhost)
- **LifeForge API:** [http://localhost/api](http://localhost/api)
- **PocketBase Dashboard:** The database is internal-only for security

<Alert className="mt-6" type="note">
#### Container Architecture

- **Client:** Nginx serving the frontend (port 80)
- **Server:** Express API server (internal)
- **Database:** PocketBase (internal)

Only port 80 is exposed externally. The API and database are accessible only within the Docker network.

#### Data Persistence

Database files are persisted to `./database/pb_data` on your host machine via Docker volume mounting. This is the same location used by manual local installation by default, allowing you to switch between Docker and local development while sharing the same data.

This directory contains:

- `data.db` - Main SQLite database
- `pb_migrations/` - Database migration files
- Other PocketBase data files

Your data will persist across container restarts. To reset the database, simply delete the `./database/pb_data` directory and restart the containers.

</Alert>

</section>

<section id="manual-installation">
## Manual Installation

If you are a developer, you must install and run LifeForge manually on your local machine.

### Prerequisites

Before you start, make sure you have the following items on hand:

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="simple-icons:raspberrypi" className="translate-y-1" />
      **A Raspberry Pi or any other computer in Unix-based systems:**
    </span>
    <span>
      This is the hardware that will be used to host the LifeForge API and
      database. You can use a Raspberry Pi, a virtual private server (VPS), or
      any other computer that uses Linux or MacOS.
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="simple-icons:nodedotjs" className="translate-y-1" />
      **Node.js (at least LTS)**
    </span>
    <span>**and**</span>
    <span className="text-bg-800 dark:text-bg-100 mx-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="simple-icons:bun" className="translate-y-1" />
    </span>
    <span className="mr-2">**Bun:**</span>
    <span>
      LifeForge is a pure TypeScript project, while the cute little bun, is used
      as the runtime environment. You can download and install bun from
      [here](https://bun.sh/).
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="simple-icons:pocketbase" className="translate-y-1" />
      **PocketBase:**
    </span>
    <span>
      This is the database that will be used to store all your data. You can
      download the latest version of PocketBase from
      [here](https://pocketbase.io/).
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="tabler:brain" className="translate-y-1" />
      **A functional brain:**
    </span>
    <span>
      You will need to have a basic understanding of how to use a terminal and
      how to run a Node.js application.
    </span>
  </div>

- <div>
    <span className="text-bg-800 dark:text-bg-100 mr-2 inline-flex -translate-y-0.5 items-center gap-2">
      <Icon icon="tabler:coffee" className="translate-y-1" />
      **A cup of coffee or tea:**
    </span>
    <span>
      This is optional, but it's always nice to have a cup of coffee by your
      side when you're coding.
    </span>
  </div>

<Alert className="mt-6" type="warning">
#### Please Don't Use Windows

According to [this site](https://www.enterpriseappstoday.com/stats/linux-statistics.html#Linux_Usage_Statistics), as of 2024,

> A staggering 96.3% of the top one million web servers run on Linux, indicating its dominance in the internet infrastructure.

LifeForge is not an exception. It's been developed and tested primarily on Unix-like systems. Using the system on Windows will be alright, since it's just a web application after all, but when it comes to hosting the backend server and database, things might get tricky.

Therefore, if you're using Windows to host the LifeForge system, you might run into some issues. A Unix-like system such as Linux or macOS is strongly recommended to host the system. If you're using Windows, you can set up a virtual machine running Linux or use the Windows Subsystem for Linux (WSL).

If you ever submit an issue regarding installation or deployment on Windows, please understand that I might simply mark it as "won't fix" since I don't have a Windows machine to test and debug the issues.

</Alert>

### System Installation

First, clone the LifeForge monorepo to your local machine or your server. You can do this by running the following command in your terminal:

```bash
git clone https://github.com/lifeforge-app/lifeforge.git
```

Then, install the dependencies by running the following command:

```bash
cd lifeforge && bun install --linker isolated
```

<Alert className="mt-6" type="warning">
#### Using `--linker isolated`

By default, Bun uses a global cache for dependencies. However, in a monorepo setup like LifeForge, this can lead to issues with dependency resolution. To avoid these issues, we recommend using the `--linker isolated` flag when installing dependencies. This will ensure that each package in the monorepo has its own isolated set of dependencies to prevent phantom dependency issues.

When doing deployment on a server, make sure to always use the `--linker isolated` flag when running `bun install`.

</Alert>

That's pretty much it for the installation of the system itself. Now, let's move on to the installation of the database.

### Database Installation

You'll need to set up a PocketBase database. For your information, PocketBase is a free, open-source, and self-hosted lightweight database. Head over to the [PocketBase website](https://pocketbase.io) and download the latest version of the database. Make sure to select the correct version for your server's operating system. Once downloaded, extract the files and inside the extracted folder, you'll find an executable file named **"pocketbase"**. Move this file to the **"database"** directory in the root of the LifeForge project.

![PocketBase Setup](https://raw.githubusercontent.com/LifeForge-app/lifeforge-docs-media/main/assets/installation/db.webp)

<Alert className="mt-6" type="note">
If you want to host the database in a different location, feel free to do so, but make sure to update the database path accordingly in the configuration file later.
</Alert>
</section>

---

And that's it! You're all set for the installation process. But before you can fire up the LifeForge system, you'll need to configure it. Let's move on to the next section to learn how to do that.
